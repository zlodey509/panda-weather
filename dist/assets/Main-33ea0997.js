import{o as N,c as R,a as c,r as x,n as K,u as P,b as m,d as E,e as y,w as r,f as n,t as o,F as Q,g as p}from"./index-f3f21ef5.js";import{C as U,_ as X}from"./Cards-e2ddb5a0.js";const Z={class:"modal__content"},b={class:"modal__content-title"},j={class:"modal__content-main"},ee={class:"modal__content-actions"},$={__name:"Modal",props:["isActive"],setup(A){return(s,w)=>(N(),R("div",{class:K(["modal",{"modal-close":!A.isActive,"modal-open":A.isActive}])},[c("div",Z,[c("span",{class:"modal__content-close closemark",onClick:w[0]||(w[0]=_=>s.$emit("onClose"))},"×"),c("div",b,[x(s.$slots,"title")]),c("div",j,[x(s.$slots,"main")]),c("div",ee,[x(s.$slots,"actions")])])],2))}},te={class:"actions"},ie={__name:"Main",setup(A){const{t:s,locale:w}=P(),_=m([]),F=m({}),v=m(!1),h=m(!1),C=m(!1),k=m(!1),f=m(!1),B="9e568924f473bc3da992488a6a8012f41e2c0973ce0d7a93ae2f9faa",L="2a21a828f79db0e623c15698e563edac",M=m(null),u={};E.get(`https://api.ipdata.co?api-key=${B}`).then(e=>{f.value=!0,M.value=e.data,S(M.value.city),O(_.value[0],0)}).catch(e=>{}).finally(e=>{});function O(e,t){f.value=!0,E.get(`https://api.openweathermap.org/data/2.5/forecast?q=${e.city}&appid=${L}&lang=${w.value}&units=${e.display_data.selected_measure.name}`).then(a=>{e.weather_data=a.data,e.weather_data.list.forEach(l=>{l.weather[0].img_url=`https://openweathermap.org/img/wn/${l.weather[0].icon}@2x.png`});const d={img_url:e.weather_data.list[0].weather[0].img_url,current_temp:e.weather_data.list[0].main.temp,feels_like:e.weather_data.list[0].main.feels_like,max_temp:e.weather_data.list[0].main.temp_max,min_temp:e.weather_data.list[0].main.temp_min,description:e.weather_data.list[0].weather[0].description,time:new Date().toLocaleTimeString().slice(0,5)};Object.assign(e.display_data.current_data,d),e.display_data.week_time_range=["d","n"],e.city_id=e.weather_data.city.id,e.isFavorite=I(e.city_id)}).then(a=>{V(e,t),T(e,t,e.weather_data.list)}).catch(a=>{var d;console.log(a),e.display_data={selected_widget:"day",selected_measure:{name:"metric",desc:"°C"}},u[`day_chart_${t}`]&&(u[`day_chart_${t}`]=null),u[`week_chart_${t}`]&&(u[`week_chart_${t}`]=null),((d=a.response)==null?void 0:d.status)==404&&(k.value=!0,e.city_id=""),f.value=!1}).finally(()=>{f.value=!1})}function S(e=""){_.value.length<5?_.value.push({id:Date.now(),city:e??"",city_id:"",isFavorite:!1,display_data:{selected_widget:"day",selected_measure:{name:"metric",desc:"°C"},current_data:{img_url:"",current_temp:"",feels_like:"",max_temp:"",min_temp:"",description:"",time:""},day:[],week:[],week_time_range:["d","n"]}}):h.value=!0}function I(e){return(JSON.parse(localStorage.getItem("favorite_list"))??[]).find(a=>a.city_id==e)!=null}function V(e,t){e.display_data.day=[];for(let a=0;a<8;a++){const d={date:e.weather_data.list[a].dt_txt,temp:e.weather_data.list[a].main.temp,img_url:e.weather_data.list[a].weather[0].img_url,description:e.weather_data.list[a].weather[0].description};e.display_data.day.push(d)}D(`day_chart_${t}`,e.display_data.day.map(a=>a.date),e.display_data.day.map(a=>a.temp))}function T(e,t,a){const d=[...new Set(a.map(i=>i.dt_txt.slice(0,10)))],l={};d.forEach(i=>l[i]=[]),a.forEach(i=>{l[i.dt_txt.slice(0,10)].push(i)}),e.display_data.week=[],Object.values(l).forEach((i,g)=>{const J={avg_temp:(i.reduce((G,H)=>G+H.main.temp,0)/i.length).toFixed(2),date:Object.keys(l)[g],img_url:`https://openweathermap.org/img/wn/${i[Math.floor(i.length/2)].weather[0].icon}@2x.png`};e.display_data.week.push(J)}),D(`week_chart_${t}`,e.display_data.week.map(i=>i.date),e.display_data.week.map(i=>i.avg_temp))}function D(e,t,a){u[e]?(u[e].data.labels=t,u[e].data.datasets[0].data=a,u[e].update()):u[e]=new U(document.getElementById(e).getContext("2d"),{type:"line",data:{labels:t,datasets:[{data:a}]},options:{plugins:{legend:{display:!1}},scales:{x:{ticks:{callback:function(d,l,i){return""}}}}}})}function W(e){F.value=e,v.value=!0}function Y(){_.value=_.value.filter(e=>e.id!=F.value.id),v.value=!1}function q(e,t,a){const l=_.value.find(g=>g.id==e.id).display_data.week_time_range;l.includes(a)?l.splice(l.indexOf(a),1):l.push(a);let i=[];i=e.weather_data.list.filter(g=>l.includes(g.sys.pod)),T(e,t,i)}function z(e,t,a){t=="metric"?e.display_data.selected_measure.desc="°C":t=="imperial"&&(e.display_data.selected_measure.desc="°F"),O(e,a)}return(e,t)=>(N(),R(Q,null,[y($,{isActive:n(v),onOnClose:t[2]||(t[2]=a=>v.value=!1)},{title:r(()=>[p(o(n(s)("Attention"))+"! ",1)]),main:r(()=>[p(o(n(s)("Are you sure for deleting the card"))+"? ",1)]),actions:r(()=>[c("div",{class:"modal__content-actions__button button button-green",onClick:t[0]||(t[0]=a=>Y())},o(n(s)("Delete")),1),c("div",{class:"modal__content-actions__button button button-grey",onClick:t[1]||(t[1]=a=>v.value=!1)},o(n(s)("Cancel")),1)]),_:1},8,["isActive"]),y($,{isActive:n(h),onOnClose:t[4]||(t[4]=a=>h.value=!1)},{title:r(()=>[p(o(n(s)("Attention"))+"! ",1)]),main:r(()=>[p(o(n(s)("You have exceeded your card limit"))+" (5)! ",1)]),actions:r(()=>[c("div",{class:"modal__content-actions__button button button-grey",onClick:t[3]||(t[3]=a=>h.value=!1)},o(n(s)("Cancel")),1)]),_:1},8,["isActive"]),y($,{isActive:n(C),onOnClose:t[6]||(t[6]=a=>C.value=!1)},{title:r(()=>[p(o(n(s)("Attention"))+"! ",1)]),main:r(()=>[p(o(n(s)("You have exceeded your favorites city limit"))+" (5)! ",1)]),actions:r(()=>[c("div",{class:"modal__content-actions__button button button-grey",onClick:t[5]||(t[5]=a=>C.value=!1)},o(n(s)("Cancel")),1)]),_:1},8,["isActive"]),y($,{isActive:n(k),onOnClose:t[8]||(t[8]=a=>k.value=!1)},{title:r(()=>[p(o(n(s)("Attention"))+"! ",1)]),main:r(()=>[p(o(n(s)("City is not found"))+"! ",1)]),actions:r(()=>[c("div",{class:"modal__content-actions__button button button-grey",onClick:t[7]||(t[7]=a=>k.value=!1)},o(n(s)("Cancel")),1)]),_:1},8,["isActive"]),c("div",te,[c("div",{class:"actions__button button button-green",onClick:t[9]||(t[9]=a=>S(""))}," + "+o(n(s)("Add new card")),1)]),y(X,{cards:n(_),"is-card-loading":n(f),isAllowToRemoveCard:!0,isAllowToSearch:!0,onOnSearch:t[10]||(t[10]=(a,d)=>O(a,d)),onLimitFavoriteCards:t[11]||(t[11]=a=>C.value=!0),onOnOpenRemoveCardModal:t[12]||(t[12]=a=>W(a)),onOnToggleTimeRange:t[13]||(t[13]=(a,d,l)=>q(d,l,a)),onOnMeasureChange:t[14]||(t[14]=(a,d,l)=>z(a,d,l))},null,8,["cards","is-card-loading"])],64))}};export{ie as default};
