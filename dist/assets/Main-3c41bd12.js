import{o as N,c as R,a as r,r as F,n as K,u as P,b as _,d as D,e as g,w as o,f as i,t as d,F as Q,g as m}from"./index-31f17ff4.js";import{C as U,_ as X}from"./Cards-d395882f.js";const Z={class:"modal__content"},b={class:"modal__content-title"},j={class:"modal__content-main"},ee={class:"modal__content-actions"},$={__name:"Modal",props:["isActive"],setup(A){return(s,y)=>(N(),R("div",{class:K(["modal",{"modal-close":!A.isActive,"modal-open":A.isActive}])},[r("div",Z,[r("span",{class:"modal__content-close closemark",onClick:y[0]||(y[0]=u=>s.$emit("onClose"))},"×"),r("div",b,[F(s.$slots,"title")]),r("div",j,[F(s.$slots,"main")]),r("div",ee,[F(s.$slots,"actions")])])],2))}},te={class:"actions"},ie={__name:"Main",setup(A){const{t:s,locale:y}=P(),u=_([]),M=_({}),p=_(!1),w=_(!1),C=_(!1),h=_(!1),v=_(!1),L="9e568924f473bc3da992488a6a8012f41e2c0973ce0d7a93ae2f9faa",E="2a21a828f79db0e623c15698e563edac",x=_(null),c={};D.get(`https://api.ipdata.co?api-key=${L}`).then(e=>{v.value=!0,x.value=e.data,T(x.value.city),O(u.value[0],0)}).catch(e=>{}).finally(e=>{});function O(e,t){v.value=!0,D.get(`https://api.openweathermap.org/data/2.5/forecast?q=${e.city}&appid=${E}&lang=${y.value}&units=${e.display_data.selected_measure.name}`).then(a=>{e.weather_data=a.data,e.weather_data.list.forEach(n=>{n.weather[0].img_url=`https://openweathermap.org/img/wn/${n.weather[0].icon}@2x.png`});const l={img_url:e.weather_data.list[0].weather[0].img_url,current_temp:e.weather_data.list[0].main.temp,feels_like:e.weather_data.list[0].main.feels_like,max_temp:e.weather_data.list[0].main.temp_max,min_temp:e.weather_data.list[0].main.temp_min,description:e.weather_data.list[0].weather[0].description,time:new Date().toLocaleTimeString().slice(0,5)};Object.assign(e.display_data.current_data,l),e.display_data.week_time_range=["d","n"],e.city_id=e.weather_data.city.id,e.isFavorite=I(e.city_id)}).then(a=>{V(e,t),S(e,t,e.weather_data.list)}).catch(a=>{var l;e.display_data={selected_widget:"day",selected_measure:{name:"metric",desc:"°C"}},c[`day_chart_${t}`]&&(c[`day_chart_${t}`]=null),c[`week_chart_${t}`]&&(c[`week_chart_${t}`]=null),((l=a.response)==null?void 0:l.status)==404&&(h.value=!0,e.city_id=""),v.value=!1}).finally(()=>{v.value=!1})}function T(e=""){u.value.length<5?u.value.push({id:Date.now(),city:e??"",city_id:"",isFavorite:!1,display_data:{selected_widget:"day",selected_measure:{name:"metric",desc:"°C"},current_data:{img_url:"",current_temp:"",feels_like:"",max_temp:"",min_temp:"",description:"",time:""},day:[],week:[]}}):w.value=!0}function I(e){return(JSON.parse(localStorage.getItem("favorite_list"))??[]).find(a=>a.city_id==e)!=null}function V(e,t){e.display_data.day=[];for(let a=0;a<8;a++){const l={date:e.weather_data.list[a].dt_txt,temp:e.weather_data.list[a].main.temp,img_url:e.weather_data.list[a].weather[0].img_url,description:e.weather_data.list[a].weather[0].description};e.display_data.day.push(l)}B(`day_chart_${t}`,e.display_data.day.map(a=>a.date),e.display_data.day.map(a=>a.temp))}function S(e,t,a){const l=Object.groupBy(a,({dt_txt:n})=>n.slice(0,10));e.display_data.week=[],Object.values(l).forEach((n,f)=>{const J={avg_temp:(n.reduce((G,H)=>G+H.main.temp,0)/n.length).toFixed(2),date:Object.keys(l)[f],img_url:`https://openweathermap.org/img/wn/${n[Math.floor(n.length/2)].weather[0].icon}@2x.png`};e.display_data.week.push(J)}),B(`week_chart_${t}`,e.display_data.week.map(n=>n.date),e.display_data.week.map(n=>n.avg_temp))}function B(e,t,a){c[e]?(c[e].data.labels=t,c[e].data.datasets[0].data=a,c[e].update()):c[e]=new U(document.getElementById(e).getContext("2d"),{type:"line",data:{labels:t,datasets:[{data:a}]},options:{plugins:{legend:{display:!1}},scales:{x:{ticks:{callback:function(l,n,f){return""}}}}}})}function W(e){M.value=e,p.value=!0}function Y(){u.value=u.value.filter(e=>e.id!=M.value.id),p.value=!1}function q(e,t,a){const n=u.value.find(k=>k.id==e.id).display_data.week_time_range;n.includes(a)?n.splice(n.indexOf(a),1):n.push(a);let f=[];f=e.weather_data.list.filter(k=>n.includes(k.sys.pod)),S(e,t,f)}function z(e,t,a){t=="metric"?e.display_data.selected_measure.desc="°C":t=="imperial"&&(e.display_data.selected_measure.desc="°F"),O(e,a)}return(e,t)=>(N(),R(Q,null,[g($,{isActive:i(p),onOnClose:t[2]||(t[2]=a=>p.value=!1)},{title:o(()=>[m(d(i(s)("Attention"))+"! ",1)]),main:o(()=>[m(d(i(s)("Are you sure for deleting the card"))+"? ",1)]),actions:o(()=>[r("div",{class:"modal__content-actions__button button button-green",onClick:t[0]||(t[0]=a=>Y())},d(i(s)("Delete")),1),r("div",{class:"modal__content-actions__button button button-grey",onClick:t[1]||(t[1]=a=>p.value=!1)},d(i(s)("Cancel")),1)]),_:1},8,["isActive"]),g($,{isActive:i(w),onOnClose:t[4]||(t[4]=a=>w.value=!1)},{title:o(()=>[m(d(i(s)("Attention"))+"! ",1)]),main:o(()=>[m(d(i(s)("You have exceeded your card limit"))+" (5)! ",1)]),actions:o(()=>[r("div",{class:"modal__content-actions__button button button-grey",onClick:t[3]||(t[3]=a=>w.value=!1)},d(i(s)("Cancel")),1)]),_:1},8,["isActive"]),g($,{isActive:i(C),onOnClose:t[6]||(t[6]=a=>C.value=!1)},{title:o(()=>[m(d(i(s)("Attention"))+"! ",1)]),main:o(()=>[m(d(i(s)("You have exceeded your favorites city limit"))+" (5)! ",1)]),actions:o(()=>[r("div",{class:"modal__content-actions__button button button-grey",onClick:t[5]||(t[5]=a=>C.value=!1)},d(i(s)("Cancel")),1)]),_:1},8,["isActive"]),g($,{isActive:i(h),onOnClose:t[8]||(t[8]=a=>h.value=!1)},{title:o(()=>[m(d(i(s)("Attention"))+"! ",1)]),main:o(()=>[m(d(i(s)("City is not found"))+"! ",1)]),actions:o(()=>[r("div",{class:"modal__content-actions__button button button-grey",onClick:t[7]||(t[7]=a=>h.value=!1)},d(i(s)("Cancel")),1)]),_:1},8,["isActive"]),r("div",te,[r("div",{class:"actions__button button button-green",onClick:t[9]||(t[9]=a=>T(""))}," + "+d(i(s)("Add new card")),1)]),g(X,{cards:i(u),"is-card-loading":i(v),isAllowToRemoveCard:!0,isAllowToSearch:!0,onOnSearch:t[10]||(t[10]=(a,l)=>O(a,l)),onLimitFavoriteCards:t[11]||(t[11]=a=>C.value=!0),onOnOpenRemoveCardModal:t[12]||(t[12]=a=>W(a)),onOnToggleTimeRange:t[13]||(t[13]=(a,l,n)=>q(l,n,a)),onOnMeasureChange:t[14]||(t[14]=(a,l,n)=>z(a,l,n))},null,8,["cards","is-card-loading"])],64))}};export{ie as default};
