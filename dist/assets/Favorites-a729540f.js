import{u as E,b as u,d as O,f as c,o as h,h as S,c as T,t as B}from"./index-da2d4d5a.js";import{C as F,_ as D}from"./Cards-670ebac6.js";const I={key:1,class:"favorite_cards_empty"},L={__name:"Favorites",setup(M){const{t:g,locale:f}=E(),w="2a21a828f79db0e623c15698e563edac",l=u([]);l.value=JSON.parse(localStorage.getItem("favorite_list"));const _=u(!1),r={};l.value.forEach((e,t)=>{p(e,t)});function p(e,t){e=l.value.find(a=>a.id==e.id),_.value=!0,O.get(`https://api.openweathermap.org/data/2.5/forecast?q=${e.city}&appid=${w}&lang=${f.value}&units=${e.display_data.selected_measure.name}`).then(a=>{e.weather_data=a.data,e.weather_data.list.forEach(i=>{i.weather[0].img_url=`https://openweathermap.org/img/wn/${i.weather[0].icon}@2x.png`}),e.display_data.current_data={img_url:e.weather_data.list[0].weather[0].img_url,current_temp:e.weather_data.list[0].main.temp,feels_like:e.weather_data.list[0].main.feels_like,max_temp:e.weather_data.list[0].main.temp_max,min_temp:e.weather_data.list[0].main.temp_min,description:e.weather_data.list[0].weather[0].description,time:new Date().toLocaleTimeString().slice(0,5)},e.display_data.week_time_range=["d","n"],e.isFavorite=!0}).then(a=>{y(e,t),m(e,t,e.weather_data.list)}).catch(a=>{var i;e.display_data={selected_widget:"day",selected_measure:{name:"metric",desc:"°C"}},r[`day_chart_${t}`]&&(r[`day_chart_${t}`]=null),r[`week_chart_${t}`]&&(r[`week_chart_${t}`]=null),((i=a.response)==null?void 0:i.status)==404&&(isCityNotFoundModalOpen.value=!0),_.value=!1}).finally(()=>{_.value=!1})}function y(e,t){e.display_data.day=[];for(let a=0;a<8;a++){const i={date:e.weather_data.list[a].dt_txt,temp:e.weather_data.list[a].main.temp,img_url:e.weather_data.list[a].weather[0].img_url,description:e.weather_data.list[a].weather[0].description};e.display_data.day.push(i)}o(`day_chart_${t}`,e.display_data.day.map(a=>a.date),e.display_data.day.map(a=>a.temp))}function m(e,t,a){const i=[...new Set(a.map(s=>s.dt_txt.slice(0,10)))],d={};i.forEach(s=>d[s]=[]),a.forEach(s=>{d[s.dt_txt.slice(0,10)].push(s)}),e.display_data.week=[],Object.values(d).forEach((s,n)=>{const $={avg_temp:(s.reduce((x,C)=>x+C.main.temp,0)/s.length).toFixed(2),date:Object.keys(d)[n],img_url:`https://openweathermap.org/img/wn/${s[Math.floor(s.length/2)].weather[0].icon}@2x.png`};e.display_data.week.push($)}),o(`week_chart_${t}`,e.display_data.week.map(s=>s.date),e.display_data.week.map(s=>s.avg_temp))}function o(e,t,a){r[e]&&r[e].destroy(),r[e]=new F(document.getElementById(e).getContext("2d"),{type:"line",data:{labels:t,datasets:[{data:a}]},options:{plugins:{legend:{display:!1}},scales:{x:{ticks:{callback:function(i,d,s){return""}}}}}})}function k(e,t,a){const d=l.value.find(n=>n.id==e.id).display_data.week_time_range;d.includes(a)?d.splice(d.indexOf(a),1):d.push(a);let s=[];s=e.weather_data.list.filter(n=>d.includes(n.sys.pod)),m(e,t,s)}function v(e,t){t=="metric"?e.display_data.selected_measure.desc="°C":t=="imperial"&&(e.display_data.selected_measure.desc="°F");const a=l.value.findIndex(i=>i.id==e.id);p(e,a)}return(e,t)=>c(l).length?(h(),S(D,{key:0,cards:c(l),"is-card-loading":c(_),isAllowToRemoveCard:!1,isAllowToSearch:!1,onOnToggleTimeRange:t[0]||(t[0]=(a,i,d)=>k(i,d,a)),onOnMeasureChange:t[1]||(t[1]=(a,i)=>v(a,i))},null,8,["cards","is-card-loading"])):(h(),T("div",I,B(c(g)("No favorite cities"))+"! ",1))}};export{L as default};
