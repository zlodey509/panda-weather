import{u as O,b as o,d as B,f as c,o as g,h as T,c as E,t as F}from"./index-7d97554a.js";import{C as S,_ as D}from"./Cards-26182e0b.js";const I={key:1,class:"favorite_cards_empty"},A={__name:"Favorites",setup(M){const{t:h,locale:f}=O(),w="2a21a828f79db0e623c15698e563edac",l=o([]);l.value=JSON.parse(localStorage.getItem("favorite_list"));const n=o(!1),d={};l.value.forEach((e,t)=>{p(e,t)});function p(e,t){e=l.value.find(a=>a.id==e.id),n.value=!0,B.get(`https://api.openweathermap.org/data/2.5/forecast?q=${e.city}&appid=${w}&lang=${f.value}&units=${e.display_data.selected_measure.name}`).then(a=>{e.weather_data=a.data,e.weather_data.list.forEach(i=>{i.weather[0].img_url=`https://openweathermap.org/img/wn/${i.weather[0].icon}@2x.png`}),e.display_data.current_data={img_url:e.weather_data.list[0].weather[0].img_url,current_temp:e.weather_data.list[0].main.temp,feels_like:e.weather_data.list[0].main.feels_like,max_temp:e.weather_data.list[0].main.temp_max,min_temp:e.weather_data.list[0].main.temp_min,description:e.weather_data.list[0].weather[0].description,time:new Date().toLocaleTimeString().slice(0,5)},e.display_data.week_time_range=["d","n"],e.isFavorite=!0}).then(a=>{y(e,t),m(e,t,e.weather_data.list)}).catch(a=>{var i;e.display_data={selected_widget:"day",selected_measure:{name:"metric",desc:"°C"}},d[`day_chart_${t}`]&&(d[`day_chart_${t}`]=null),d[`week_chart_${t}`]&&(d[`week_chart_${t}`]=null),((i=a.response)==null?void 0:i.status)==404&&(isCityNotFoundModalOpen.value=!0),n.value=!1}).finally(()=>{n.value=!1})}function y(e,t){e.display_data.day=[];for(let a=0;a<8;a++){const i={date:e.weather_data.list[a].dt_txt,temp:e.weather_data.list[a].main.temp,img_url:e.weather_data.list[a].weather[0].img_url,description:e.weather_data.list[a].weather[0].description};e.display_data.day.push(i)}u(`day_chart_${t}`,e.display_data.day.map(a=>a.date),e.display_data.day.map(a=>a.temp))}function m(e,t,a){const i=Object.groupBy(a,({dt_txt:s})=>s.slice(0,10));e.display_data.week=[],Object.values(i).forEach((s,r)=>{const $={avg_temp:(s.reduce((x,C)=>x+C.main.temp,0)/s.length).toFixed(2),date:Object.keys(i)[r],img_url:`https://openweathermap.org/img/wn/${s[Math.floor(s.length/2)].weather[0].icon}@2x.png`};e.display_data.week.push($)}),u(`week_chart_${t}`,e.display_data.week.map(s=>s.date),e.display_data.week.map(s=>s.avg_temp))}function u(e,t,a){d[e]?(d[e].data.labels=t,d[e].data.datasets[0].data=a,d[e].update()):d[e]=new S(document.getElementById(e).getContext("2d"),{type:"line",data:{labels:t,datasets:[{data:a}]},options:{plugins:{legend:{display:!1}},scales:{x:{ticks:{callback:function(i,s,r){return""}}}}}})}function k(e,t,a){const s=l.value.find(_=>_.id==e.id).display_data.week_time_range;s.includes(a)?s.splice(s.indexOf(a),1):s.push(a);let r=[];r=e.weather_data.list.filter(_=>s.includes(_.sys.pod)),m(e,t,r)}function v(e,t){t=="metric"?e.display_data.selected_measure.desc="°C":t=="imperial"&&(e.display_data.selected_measure.desc="°F");const a=l.value.findIndex(i=>i.id==e.id);p(e,a)}return(e,t)=>c(l).length?(g(),T(D,{key:0,cards:c(l),"is-card-loading":c(n),isAllowToRemoveCard:!1,isAllowToSearch:!1,onOnToggleTimeRange:t[0]||(t[0]=(a,i,s)=>k(i,s,a)),onOnMeasureChange:t[1]||(t[1]=(a,i)=>v(a,i))},null,8,["cards","is-card-loading"])):(g(),E("div",I,F(c(h)("No favorite cities"))+"! ",1))}};export{A as default};
